<!DOCTYPE html>
<html>
<head>
<title>MatrixOS Authenticator</title>
<style>
body{background:black;color:#00ffcc;font-family:monospace;text-align:center;padding:40px}
.box{border:2px solid #00ffcc;padding:20px;margin:auto;max-width:400px}
.code{font-size:40px;margin:20px 0}
</style>
</head>
<body>

<div class="box">
<h2>MatrixOS Authenticator</h2>
<div id="pair"></div>
<div id="codeBox" style="display:none">
<p>Your code:</p>
<div class="code" id="code"></div>
<p>Refreshes every 30s</p>
</div>
</div>

<script>
// FIRST TIME: create secret
let secret = localStorage.getItem("matrix_secret");

if(!secret){
  secret = Math.random().toString(36).substring(2,12);
  localStorage.setItem("matrix_secret",secret);

  pair.innerHTML = `
  <p>FIRST TIME SETUP</p>
  <p>Copy this secret into MatrixOS when pairing:</p>
  <div class="code">${secret}</div>
  `;
}else{
  pair.style.display="none";
  codeBox.style.display="block";
}

function gen(){
  const slice = Math.floor(Date.now()/30000);
  let hash=0;
  const str = secret+slice;
  for(let i=0;i<str.length;i++){
    hash=(hash*31+str.charCodeAt(i))%1000000;
  }
  code.textContent = hash.toString().padStart(6,"0");
}

gen();
setInterval(gen,1000);
</script>

</body>
</html>
